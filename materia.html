<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalle de Materia</title>
    <link rel="stylesheet" href="dashboard.css">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header class="main-header">
        <h1 id="materia-name-header">Cargando materia...</h1>
        <a href="/dashboard.html" class="btn btn-secondary">Volver al Dashboard</a>
    </header>

    <main class="container">
        <nav class="tabs">
            <a href="#" class="tab active" data-tab="asistencia">Asistencia</a>
            <a href="#" class="tab" data-tab="alumnos">Alumnos</a>
            <a href="#" class="tab" data-tab="actividades">Actividades</a>
            <a href="#" class="tab" data-tab="evaluaciones">Evaluaciones</a>
            <a href="#" class="tab" data-tab="material">Material Didáctico</a>
            <a href="#" class="tab" data-tab="unidades">Unidades</a>
        </nav>

        <div id="asistencia-content" class="tab-content active">
            <div class="attendance-panel">
                <div class="control-panel form-card">
                    <h2>Control de Asistencia por QR</h2>
                    <div class="input-group">
                        <label for="unit-number">Seleccionar Unidad</label>
                        <input type="number" id="unit-number" value="1" min="1">
                    </div>
                    <button id="generate-qr-btn" class="btn btn-primary">Generar QR para Asistencia</button>
                    <div id="qr-session-active" class="hidden">
                        <div id="qrcode-container"></div>
                        <div id="timer">05:00</div>
                        <div class="qr-actions">
                            <button id="renew-qr-btn" class="btn btn-secondary">Renovar (5 min)</button>
                            <button id="cancel-qr-btn" class="btn btn-danger">Cancelar Sesión</button>
                        </div>
                    </div>
                </div>
                <div class="realtime-list list-card">
                    <h2>Asistencias Registradas (En Vivo)</h2>
                    <ul id="realtime-attendance-list"></ul>
                </div>
            </div>
            <div class="manual-attendance-panel list-card" style="margin-top: 2rem;">
                <h2>Tomar Asistencia Manualmente</h2>
                <button id="export-asistencia-btn" class="btn btn-secondary" style="margin-bottom: 1rem; background-color: #1D6F42;">Exportar Asistencias de la Unidad a Sheets</button>
                <div id="manual-attendance-student-list"></div>
                <button id="save-manual-attendance-btn" class="btn btn-primary" style="margin-top: 1rem;">Guardar Asistencia Manual</button>
            </div>
        </div>

        <div id="alumnos-content" class="tab-content">
            <section class="form-card">
                <h2>Añadir Alumno Manualmente</h2>
                <form id="add-student-form">
                    <div class="form-row">
                        <div class="input-group">
                            <label for="first_name">Nombre(s)</label>
                            <input type="text" id="first_name" required>
                        </div>
                        <div class="input-group">
                            <label for="last_name">Apellidos</label>
                            <input type="text" id="last_name" required>
                        </div>
                        <div class="input-group">
                            <label for="student_id">Matrícula</label>
                            <input type="text" id="student_id" required>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Añadir Alumno</button>
                </form>
            </section>
            <section class="list-card">
                <h2>Alumnos Inscritos</h2>
                <ul id="student-list" class="student-list"></ul>
            </section>
        </div>
        
        <div id="actividades-content" class="tab-content">
            <div class="activities-panel" style="display: grid; grid-template-columns: 1fr 2fr; gap: 2rem;">
                <section class="form-card">
                    <h2>Añadir Nueva Actividad</h2>
                    <form id="add-activity-form">
                        </form>
                </section>
                <section class="list-card">
                    <h2>Actividades de la Materia</h2>
                    <button id="export-actividades-btn" class="btn btn-secondary" style="margin-bottom: 1rem; background-color: #1D6F42;">Exportar Calificaciones a Sheets</button>
                    <div id="activities-list"></div>
                </section>
            </div>
            <div id="grading-panel" class="hidden">
                </div>
        </div>

        <div id="evaluaciones-content" class="tab-content">
            <div class="evaluations-panel" style="display: grid; grid-template-columns: 1fr 2fr; gap: 2rem;">
                <section class="form-card">
                    <h2>Añadir Nueva Evaluación</h2>
                    <form id="add-evaluation-form">
                        </form>
                </section>
                <section class="list-card">
                    <h2>Evaluaciones de la Materia</h2>
                    <button id="export-evaluaciones-btn" class="btn btn-secondary" style="margin-bottom: 1rem; background-color: #1D6F42;">Exportar Calificaciones a Sheets</button>
                    <div id="evaluations-list"></div>
                </section>
            </div>
            <div id="evaluation-grading-panel" class="hidden">
                </div>
        </div>

        <div id="material-content" class="tab-content">
            <section class="list-card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                    <h2>Material Didáctico</h2>
                    <button id="add-material-btn" class="btn btn-primary">Añadir Material desde Drive</button>
                </div>
                <div id="materials-list"></div>
            </section>
        </div>

        <div id="unidades-content" class="tab-content">
            <section class="form-card">
                <h2>Crear Nueva Unidad</h2>
                <form id="create-unit-form">
                    <div class="form-row">
                        <div class="input-group">
                            <label for="unit_number_input">Número de Unidad</label>
                            <input type="number" id="unit_number_input" min="1" required>
                        </div>
                        <div class="input-group">
                            <label for="unit_ponderation">Ponderación (%)</label>
                            <input type="number" id="unit_ponderation" min="0" max="100" step="0.1" required placeholder="Ej: 25">
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Crear Unidad</button>
                </form>
            </section>
            <section class="list-card">
                <h2>Unidades de la Materia</h2>
                <div id="units-list"></div>
            </section>
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator/qrcode.js"></script>
    <script src="materia.js"></script>
    <script async defer src="https://apis.google.com/js/api.js" onload="gapiLoaded()"></script>
    <script async defer src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>
</body>
</html>